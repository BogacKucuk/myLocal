package com.garantibbva.depositwithdrawalmngt.depositwithdrawalchannel.service.mapper;

import com.garantibbva.depositwithdrawalmngt.depositwithdrawalchannel.service.mapper.config.GrpcMapperConfig;
import com.garantibbva.depositwithdrawalmngt.depositwithdrawalchannel.service.model.request.DigitalOrderReadRequestDto;
import com.garantibbva.depositwithdrawalmngt.depositwithdrawalchannel.service.model.response.DigitalOrderReadResponseDto;
import com.garantibbva.depositwithdrawalmngt.depositwithdrawalchannel.service.model.response.ReadBranchInstructionDepositWithdrawalDto;
import com.garantibbva.depositwithdrawalmngt.moneywithdrawbusiness.proto.DigitalOrderProto;
import com.garantibbva.depositwithdrawalmngt.moneywithdrawbusiness.proto.DigitalOrderProto.ReadBranchInstructionDepositWithdrawal;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.factory.Mappers;

import java.util.List;
import java.util.stream.Collectors;

@Mapper(config = GrpcMapperConfig.class)
public interface DigitalOrderMapper {

    DigitalOrderMapper INSTANCE = Mappers.getMapper(DigitalOrderMapper.class);

    // Request mapping - BigDecimalMapper otomatik kullanılacak
    DigitalOrderProto.DigitalOrderReadRequest toGrpcRequest(DigitalOrderReadRequestDto requestDto);

    // Response mapping - Manuel yapıyoruz çünkü field name mismatch var
    default DigitalOrderReadResponseDto toResponseDto(DigitalOrderProto.DigitalOrderReadResponse grpcResponse) {
        if (grpcResponse == null) {
            return null;
        }
        
        DigitalOrderReadResponseDto responseDto = new DigitalOrderReadResponseDto();
        
        // Liste mapping - her bir gRPC item'ı DTO'ya çeviriyoruz
        if (grpcResponse.getReadBranchInstructionDepositWithdrawalList() != null) {
            List<ReadBranchInstructionDepositWithdrawalDto> dtoList = 
                grpcResponse.getReadBranchInstructionDepositWithdrawalList()
                    .stream()
                    .map(this::toReadBranchInstructionDepositWithdrawalDto)
                    .collect(Collectors.toList());
            
            responseDto.setReadBranchInstructionDepositWithdrawal(dtoList);
        }
        
        return responseDto;
    }

    // Nested object mapping - BigDecimalMapper otomatik kullanılacak
    ReadBranchInstructionDepositWithdrawalDto toReadBranchInstructionDepositWithdrawalDto(
        ReadBranchInstructionDepositWithdrawal grpcItem);
}
