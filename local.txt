// getDocuments fonksiyonunun .then(...) kısmında:
const newDocsMap = generateDocsMapWrapper(response);
setDocsMap(newDocsMap);

// Sonra bbtDocsChecks'i oluşturuyorsun
const documentChecks = generateCheckboxStates(response);
setBbtDocsChecks(documentChecks);







// children dahil hepsini rekurzif olarak aynı checked değerine getirir
function checkAllChildren(docsMap, checksArr, parentKey, newChecked) {
  // parentKey'in children'larını al
  const childKeys = docsMap[parentKey]?.children || [];

  // checksArr üstünde childKeys'e sahip item'ları bul ve hepsini newChecked yap
  childKeys.forEach((childKey) => {
    const childIndex = checksArr.findIndex((c) => c.id === childKey);
    if (childIndex > -1) {
      checksArr[childIndex].checked = newChecked;
    }
    // rekurzif olarak o child'ın da children'ları olabilir:
    checkAllChildren(docsMap, checksArr, childKey, newChecked);
  });
}








function updateParentIfAllChildrenChecked(docsMap, checksArr, childKey) {
  const parentKey = docsMap[childKey]?.parent;
  if (!parentKey) return; // parent yoksa çık

  // parent'ın tüm children'ı
  const siblings = docsMap[parentKey]?.children || [];
  // hepsi checked mi?
  const allSiblingsChecked = siblings.every((sKey) => {
    const found = checksArr.find((c) => c.id === sKey);
    return found?.checked === true;
  });

  if (allSiblingsChecked) {
    // parent'ı true yap
    const parentIndex = checksArr.findIndex((c) => c.id === parentKey);
    if (parentIndex > -1) {
      checksArr[parentIndex].checked = true;
    }
    // eğer parent'ın da parent'ı varsa, orayı da güncellemek istersen yine rekurzif
    updateParentIfAllChildrenChecked(docsMap, checksArr, parentKey);
  }
}




const toggleChecked = (e) => {
  const clickedId = e.target.id; // docKey
  // Yeni check durumu
  const foundIndex = bbtDocsChecks.findIndex((item) => item.id === clickedId);
  if (foundIndex < 0) return;

  // Kopyasını alıp güncelle
  const updatedChecks = [...bbtDocsChecks];
  const oldValue = updatedChecks[foundIndex].checked;
  const newValue = !oldValue;
  updatedChecks[foundIndex].checked = newValue;

  // EĞER parent checkbox'ı işaretlendiyse altındaki tüm child'ları da güncelle
  // (docsMap'de clickedId'nin children'ları varsa)
  if (docsMap[clickedId]?.children?.length > 0) {
    checkAllChildren(docsMap, updatedChecks, clickedId, newValue);
  }

  // EĞER child işaretlendiyse parent'ı güncellemek istersen:
  // (clickedId'nin bir parent'ı varsa ve newValue === true)
  if (newValue === true) {
    updateParentIfAllChildrenChecked(docsMap, updatedChecks, clickedId);
  }
  // (Eğer "child false olduysa parent false olsun" gibi bir senaryon var ise
  // updateParentIfAllChildrenUnchecked(...) gibi ayrı bir fonksiyon yazıp burada çağırabilirsin.)

  setBbtDocsChecks(updatedChecks);
  dispatch(moneyDepositActions.setBbtDocsChecks(updatedChecks));
};
