@Test
void testCalculateAmountTextAndIsKgvIncluded_WithCommission() throws Exception {
    // Arrange
    CashTransactionDetailDTO detailDTO = new CashTransactionDetailDTO();
    detailDTO.setAmount(BigDecimal.valueOf(1000));
    detailDTO.setCurrency("TL");
    detailDTO.setAccountCurrency("TL");
    detailDTO.setCommissionAmount(BigDecimal.valueOf(50));

    CashTransactionStoredRequest storedRequest = new CashTransactionStoredRequest();
    storedRequest.setTakeCommissionFromTransactionAmount(Boolean.FALSE);
    detailDTO.setCashTransactionStoredRequest(storedRequest);

    List<CashTransactionDetailDTO> detailDTOList = Collections.singletonList(detailDTO);

    Method method = CustomerNotificationService.class
            .getDeclaredMethod("calculateAmountTextAndIsKgvIncluded", List.class);
    method.setAccessible(true);

    // Act
    CustomerNotificationService.AmountCalculationResult calculationResult =
            (CustomerNotificationService.AmountCalculationResult) method.invoke(customerNotificationService, detailDTOList);

    // Assert
    assertNotNull(calculationResult.getAmountText());
    // Komisyon var ama KMV yok + currency == accountCurrency => isKgvIncluded=false
    // Bu satırı assertFalse olarak düzeltelim
    assertFalse(calculationResult.getIsKgvIncluded());
}
